<!doctype html>
<html lang="uft-8">
<head>
    <!--#include file="/public/head.inc"-->
</head>
<body>
<!--#include file="/public/menu.inc"-->
    <div data-simplebar>
        <main class="page-content uart" id="app" v-cloak>
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-transparent">
                            <div class="p-2 mb-0 d-flex align-items-end">
                                <cn>基本设置</cn>
                                <en>Basic config</en>
                            </div>
                        </div>
                        <div class="card-body pb-4">
                            <div class="force-aspect-ratio">
                                <div class="aspect-ratio-content d-flex flex-column justify-content-between">
                                    <div class="row"></div>
                                    <div class="row"></div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>串口</cn>
                                                <en>Serial port</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select class="form-select">
                                                <option value="/dev/ttyAMA1">ttyAMA1</option>
                                                <option value="/dev/ttyUSB0">ttyUSB0</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>波特率</cn>
                                                <en>BaudRate</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select class="form-select">
                                                <option value="115200">115200</option>
                                                <option value="9600">9600</option>
                                                <option value="4800">4800</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>网络端口</cn>
                                                <en>Socket port</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>IP地址</cn>
                                                <en>IP Address</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <button type="button" class="btn border-3 btn-primary px-4 me-3">
                                                <cn>保存</cn>
                                                <en>Save</en>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row"></div>
                                    <div class="row"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header bg-transparent">
                            <div class="p-2 mb-0 d-flex align-items-end">
                                <cn>按键定义</cn>
                                <en>Button define</en>
                            </div>
                        </div>
                        <div class="card-body pb-4">
                            <div class="force-aspect-ratio">
                                <div class="aspect-ratio-content d-flex flex-column justify-content-between">
                                    <div class="row"></div>
                                    <div class="row"></div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>总开关</cn>
                                                <en>Main enable</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <bootstrap-switch v-model="" size="normal"></bootstrap-switch>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>源设备名</cn>
                                                <en>Source name</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 offset-lg-1 force-align-center">
                                            <label>
                                                <cn>源列表</cn>
                                                <en>Source List</en>
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select class="form-select" v-model="">
                                                <option v-for=""></option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <button type="button" class="btn border-3 btn-primary px-4 me-3"><cn>刷新</cn><en>Refresh</en></button>
                                            <button type="button" class="btn border-3 btn-primary px-4 me-3"><cn>选择</cn><en>Select</en></button>
                                            <button type="button" class="btn border-3 btn-primary px-4"><cn>输出</cn><en>Display</en></button>
                                        </div>
                                    </div>
                                    <div class="row"></div>
                                    <div class="row"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!--#include file="/public/footer.inc"-->

<script type="module">
    import { rpc,alertMsg } from "./assets/js/helper.js";
    import { useDefaultConf } from "./assets/js/confHooks.js";
    import { bootstrapSwitchComponent } from "./assets/js/vueHelper.js"
    
    const {createApp,ref,reactive,watch,watchEffect,computed} = Vue;
    const app = createApp({
        components:{
            "bootstrap-switch" : bootstrapSwitchComponent
        },
        setup(props,context) {
            
            const { defaultConf } = useDefaultConf();
            
            let state = {
                chnIndex: ref(-1),
                chnImgUrl: ref("assets/images/nosignal.jpg"),
            }
            
            const updateChnImage = () => {
                if(defaultConf[state.chnIndex.value].enable)
                    state.chnImgUrl.value = "snap/snap" + state.chnIndex.value + ".jpg?rnd=" + Math.random();
                else
                    state.chnImgUrl.value = "assets/images/nosignal.jpg";
                
                setTimeout(() => { rpc( "enc.snap" ) },200)
                setTimeout(updateChnImage,500);
            }
            
            
            const unwatch = watchEffect(()=>{
                if(Object.keys(defaultConf).length > 0) {
                    for(let i=0;i<defaultConf.length;i++) {
                        if(defaultConf[i].type !== "ndi")
                            continue;
                        state.chnIndex.value = i;
                    }
                    updateChnImage();
                    unwatch();
                }
            })
            
            
            const saveConf = () => {
                // rpc( "enc.updateOverlay", [ JSON.stringify( overlayConf, null, 2 ) ], data => {
                //     if ( typeof ( data.error ) != "undefined" )
                //         alertMsg('<cn>保存设置失败</cn><en>Save config failed!</en>', 'error');
                //     else
                //         alertMsg('<cn>保存设置成功</cn><en>Save config success!</en>', 'success');
                // } );
            }
            
            return {...state,saveConf}
        }
    });
    app.mount('#app');
</script>
</body>
</html>